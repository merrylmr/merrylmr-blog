(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{345:function(t,e,n){"use strict";n.r(e);var a=n(14),s=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"vuecli3打包优化-抽离依赖包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vuecli3打包优化-抽离依赖包"}},[t._v("#")]),t._v(" VueCLI3打包优化--抽离依赖包")]),t._v(" "),e("p",[t._v("项目开发中，使用了很多依赖包，如"),e("code",[t._v("Vue")]),t._v("、路由管理"),e("code",[t._v("Vue-router")]),t._v("、状态管理"),e("code",[t._v("Vuex")]),t._v("、UI组件库("),e("code",[t._v("ElementUI")]),t._v("、"),e("code",[t._v("Vant")]),t._v(")、图表（"),e("code",[t._v("echarts")]),t._v("）等。打包构建，发现有一些包体积过大，会影响首页加载速度。如下所示：\n"),e("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/11899053-de060a0c0f6fe967.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),t._v(" "),e("p",[t._v("从上图的分析包中，可以将以下插件抽离：")]),t._v(" "),e("ul",[e("li",[t._v("echarts")]),t._v(" "),e("li",[t._v("vue-echarts")]),t._v(" "),e("li",[t._v("elementUI")]),t._v(" "),e("li",[t._v("vue")]),t._v(" "),e("li",[t._v("vuex")]),t._v(" "),e("li",[t._v("vue-router")]),t._v(" "),e("li",[t._v("axios")]),t._v(" "),e("li",[t._v("moment.js")])]),t._v(" "),e("p",[t._v("需要删除的依赖包")]),t._v(" "),e("ul",[e("li",[t._v("mock.js(在生产环境无需此依赖包)")])]),t._v(" "),e("h2",{attrs:{id:"如何生成分析包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何生成分析包"}},[t._v("#")]),t._v(" 如何生成分析包")]),t._v(" "),e("p",[t._v("VueCLI3自带了"),e("code",[t._v("webpack analzer")]),t._v(",可通过如下命令即可生成分析包内容，在"),e("code",[t._v("dist/report.html")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("npm run build --report\n")])])]),e("p",[t._v("更多请查看：\nhttps://cli.vuejs.org/zh/guide/cli-service.html#vue-cli-service-serve")]),t._v(" "),e("h2",{attrs:{id:"优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化"}},[t._v("#")]),t._v(" 优化")]),t._v(" "),e("p",[t._v("减少打包体积、加快打包速度，常规的优化有以下两种：")]),t._v(" "),e("ol",[e("li",[e("strong",[t._v("按需引用")])])]),t._v(" "),e("p",[t._v("按需加载是通过只引用使用的组件来减少体积，这就会有一个问题：如果项目重度依赖第三方插件（如"),e("code",[t._v("ElementUI")]),t._v("、"),e("code",[t._v("vant")]),t._v("），那么此方案将无法减少打包的体积。")]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[e("strong",[t._v("CDN")])])]),t._v(" "),e("ul",[e("li",[e("p",[t._v("直接不参与打包，减小包体积、加快打包速度；")])]),t._v(" "),e("li",[e("p",[t._v("使用可靠的CDN服务可加快网站加载;")])])]),t._v(" "),e("p",[t._v("这里选择CDN的方式，"),e("strong",[t._v("配置流程")]),t._v("：")]),t._v(" "),e("ol",[e("li",[t._v("vue.config.js下的配置如下")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("  externals: [\n            {\n                'vue': 'Vue',\n                'vue-router': 'VueRouter',\n                'vuex': 'Vuex',\n                'element-ui': 'ELEMENT',\n                'echarts': 'echarts',\n                'vue-echarts': 'VueECharts',\n                'moment': 'moment',\n                'axios': 'axios',\n            },  \n           // vue-echarts引入的方式，需要如下去抽离\n            'echarts/lib/echarts',\n            /^echarts\\/lib\\/chart\\/.+$/i,\n            /^echarts\\/lib\\/component\\/.+$/i,\n        ]\n\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[t._v("配置CDN")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("const cdn = {\n    js: ['https://lib.baomitu.com/echarts/4.9.0-rc.1/echarts.min.js',\n        'https://lib.baomitu.com/vue-echarts/5.0.0-beta.0/vue-echarts.min.js',\n        'https://lib.baomitu.com/vue/2.6.10/vue.min.js',\n        'https://lib.baomitu.com/vuex/3.1.0/vuex.min.js',\n        'https://lib.baomitu.com/vue-router/3.0.6/vue-router.min.js',\n        'https://lib.baomitu.com/moment.js/2.29.1/moment.min.js',\n        'https://lib.baomitu.com/element-ui/2.15.1/index.min.js'],\n    css: ['https://lib.baomitu.com/element-ui/2.15.1/theme-chalk/index.min.css']\n}\nmodule.exports = {\n configureWebpack:{......},\nchainWebpack(config) {\n    config.plugin('html').tap(opts => {\n            opts[0].cdn = cdn;\n            return opts\n        })\n  }\n}\n\n\n")])])]),e("p",[t._v("可根据环境变量，仅在线上采取使用CDN,开发环境直接使用npm依赖包即可。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("const IsProd= process.env.NODE_ENV === 'production';\n\nchainWebpack(config) {\n    if (IsProd) {\n        config.plugin('html').tap(opts => {\n            opts[0].cdn = cdn;\n            return opts\n        })\n  }\n}\n\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[t._v("index.html文件")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('<!DOCTYPE html>\n<html lang="en">\n    \x3c!-- 使用CDN的CSS文件 --\x3e\n    <% for (var i in htmlWebpackPlugin.options.cdn && htmlWebpackPlugin.options.cdn.css) { %>\n      <link href="<%= htmlWebpackPlugin.options.cdn.css[i] %>" rel="preload" as="style">\n      <link href="<%= htmlWebpackPlugin.options.cdn.css[i] %>" rel="stylesheet">\n    <% } %>\n    \x3c!-- 使用CDN的JS文件 --\x3e\n    <% for (var i in htmlWebpackPlugin.options.cdn && htmlWebpackPlugin.options.cdn.js) { %>\n      <link href="<%= htmlWebpackPlugin.options.cdn.js[i] %>" rel="preload" as="script">\n    <% } %>\n  </head>\n  <body>\n    <div id="app"></div>\n    \x3c!-- built files will be auto injected --\x3e\n    <% for (var i in htmlWebpackPlugin.options.cdn && htmlWebpackPlugin.options.cdn.js) { %>\n      <script src="<%= htmlWebpackPlugin.options.cdn.js[i] %>"><\/script>\n    <% } %>\n  </body>\n</html>\n')])])]),e("p",[t._v("进行包分离以后，打包结果：\n"),e("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/11899053-5cf8eba8355f9e56.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),t._v(" "),e("h2",{attrs:{id:"注意"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[t._v("#")]),t._v(" 注意")]),t._v(" "),e("ol",[e("li",[t._v("vue-charts抽离\nexternal需要用正则表达式来抽离")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("       'echarts/lib/echarts',\n        /^echarts\\/lib\\/chart\\/.+$/i,\n        /^echarts\\/lib\\/component\\/.+$/i,\n")])])]),e("h3",{attrs:{id:"多页面cdn-抽离"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#多页面cdn-抽离"}},[t._v("#")]),t._v(" 多页面CDN 抽离")]),t._v(" "),e("blockquote",[e("p",[t._v("提示\n当在 multi-page 模式下构建时，webpack 配置会包含不一样的插件 (这时会存在多个 html-webpack-plugin 和 preload-webpack-plugin 的实例)。如果你试图修改这些插件的选项，请确认运行 vue inspect。https://cli.vuejs.org/zh/config/#pages")])]),t._v(" "),e("p",[e("code",[t._v("vue.config.js")]),t._v("的pages为：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("pages: {\n\t\t// 后台管理\n\t\tindex: {\n\t\t\tentry: 'src/pages/manage/index.js',\n\t\t\ttemplate: 'src/pages/manage/index.html',\n\t\t\tfilename: 'index.html',\n\t\t\tchunks: ['chunk-vendors', 'chunk-common', 'index']\n\t\t},\n\t\t// pc编辑器\n\t\tpc: {\n\t\t\tentry: 'src/pages/pc/index.js',\n\t\t\ttemplate: 'src/pages/pc/index.html',\n\t\t\tfilename: 'pc/index.html',\n\t\t\tchunks: ['chunk-vendors', 'chunk-common', 'pc']\n\t\t},\n\t\t// 渲染\n\t\trender: {\n\t\t\tentry: 'src/pages/render/index.js',\n\t\t\ttemplate: 'src/pages/render/index.html',\n\t\t\tfilename: 'render/index.html',\n\t\t\tchunks: ['chunk-vendors', 'chunk-common', 'render']\n\t\t},\n\t},\n")])])]),e("p",[t._v("修改如下的地方：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("//  注意：index、pc、render为pages下的名称\nchainWebpack(config) {\n    if (IsProd) {\n    \t['index', 'pc', 'render'].forEach(chunk => {\n\t\t\t\tconfig.plugin(\"html-\" + chunk).tap(args => {\n\t\t\t\t\targs[0].cdn = cdn;\n\t\t\t\t\treturn args;\n\t\t\t\t});\n\t\t\t})\n  }\n}\n\n\n")])])]),e("h2",{attrs:{id:"参考文档"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[t._v("#")]),t._v(" 参考文档")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://www.webpackjs.com/configuration/externals/",target:"_blank",rel:"noopener noreferrer"}},[t._v("外部扩展(externals)"),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://github.com/ecomfe/vue-echarts/issues/92",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用webpack的externals来指定echarts无法减少包的大小"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://blog.csdn.net/sanchuanhi/article/details/105259027",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-cli利用webpack-bundle-analyzer分析构建产物"),e("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=s.exports}}]);